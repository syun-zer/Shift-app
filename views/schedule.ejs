<style>
.staff-count {
  text-align: center;
  font-weight: bold;
}
.staff-sufficient {
  color: #4caf50;
}
.staff-insufficient {
  color: #f44336;
}
.short-staffed-row {
  background-color: #ffebee;
}
</style>

<h2>æœˆé–“ã‚·ãƒ•ãƒˆè¡¨ï¼ˆ<%= currentYear %>å¹´<%= currentMonth %>æœˆï¼‰</h2>

<div style="margin-bottom: 20px;">
  <form method="GET" action="/schedule" style="display: inline-block; margin-right: 20px;">
    <label for="year">å¹´:</label>
    <select name="year" id="year">
      <% for (let y = 2024; y <= 2026; y++) { %>
        <option value="<%= y %>" <%= y === currentYear ? 'selected' : '' %>><%= y %></option>
      <% } %>
    </select>
    
    <label for="month">æœˆ:</label>
    <select name="month" id="month">
      <% for (let m = 1; m <= 12; m++) { %>
        <option value="<%= m %>" <%= m === currentMonth ? 'selected' : '' %>><%= m %></option>
      <% } %>
    </select>
    
    <button type="submit">è¡¨ç¤º</button>
  </form>
  
  <strong>å¿…è¦äººæ•°: <%= requiredStaff %>äºº</strong>
</div>

<table border="1" style="border-collapse: collapse;">
  <thead>
    <tr>
      <th>æ—¥ä»˜</th>
      <% users.forEach(user => { %>
        <th><%= user.username %></th>
      <% }); %>
      <th>å®Ÿéš›/å¿…è¦</th>
    </tr>
  </thead>
  <tbody>
    <% dates.forEach(dateInfo => { %>
      <tr class="<%= dateInfo.isShortStaffed ? 'short-staffed-row' : '' %>">
        <td><%= dateInfo.day %>(<%= dateInfo.dayOfWeek %>)</td>
        <% users.forEach(user => { %>
          <%
            // ã“ã®æ—¥ä»˜ã«ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚·ãƒ•ãƒˆãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            const hasShift = shifts.some(shift => 
              shift.userId === user.id && 
              shift.date.startsWith(dateInfo.date)
            );
          %>
          <td style="text-align: center; width: 60px;">
            <%= hasShift ? 'â—‹' : '' %>
          </td>
        <% }); %>
        <td class="staff-count <%= dateInfo.isShortStaffed ? 'staff-insufficient' : 'staff-sufficient' %>">
          <%= dateInfo.actualCount %>/<%= requiredStaff %>
          <%= dateInfo.isShortStaffed ? 'âš ï¸' : 'âœ“' %>
        </td>
      </tr>
    <% }); %>
  </tbody>
</table>

<div style="margin-top: 10px; font-size: 14px;">
  <span style="background-color: #ffebee; padding: 2px 5px;">ğŸŸ¥ äººæ•°ä¸è¶³</span>
  <span style="margin-left: 10px;">â¬œ å¿…è¦äººæ•°ç¢ºä¿</span>
</div>
