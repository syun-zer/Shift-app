 <button id="logoutButton" onclick="logout()">Logout</button>
    <h2>Add new shift</h2>
    <form id="shiftForm" onsubmit="create(event)">
      <label for="date">date:</label>
      <input type="datetime-local" name="date" id="date" required>
      <button type="submit">Add Shift</button>
    </form>
    <hr />
    <h2>Your Future-shift list:</h2>
    <ul id="futureShifts"></ul>
    
    <hr />
    <h2>Your Past-shift list:</h2>
    <ul id="pastShifts"></ul>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        fetchShifts();
        loadPreviousTime();
      });

      function loadPreviousTime() {
        const savedTime = localStorage.getItem('lastShiftTime');
        if (savedTime) {
          const dateInput = document.getElementById('date');
          const today = new Date().toISOString().split('T')[0]; // 今日の日付（YYYY-MM-DD形式）
          dateInput.value = today + 'T' + savedTime; // 今日の日付 + 保存された時間
        }
      }

      function saveCurrentTime(dateValue) {
        if (dateValue) {
          const timeOnly = dateValue.split('T')[1]; // 時間部分のみ取得 (HH:MM)
          if (timeOnly) {
            localStorage.setItem('lastShiftTime', timeOnly);
          }
        }
      }

      async function fetchShifts() {
        const response = await fetch('/api/shifts');
        const shifts = await response.json();

        // 未来のシフト表示
        const futureShifts = document.querySelector('#futureShifts');
        futureShifts.innerHTML = '';
        shifts.futureShifts.forEach(shift => {
          const li = document.createElement('li');
          li.textContent = shift.date;
          const deleteButton = document.createElement('button');
          deleteButton.textContent = 'Delete';
          deleteButton.className = 'mini';
          deleteButton.onclick = () => deleteShift(shift.id);
          li.appendChild(deleteButton);
          futureShifts.appendChild(li);
        });

        // 過去のシフト表示
        const pastShifts = document.querySelector('#pastShifts');
        pastShifts.innerHTML = '';
        shifts.pastShifts.forEach(shift => {
          const li = document.createElement('li');
          li.textContent = shift.date;
          li.style.color = '#666'; // 過去のシフトは薄い色で表示
          const deleteButton = document.createElement('button');
          deleteButton.textContent = 'Delete';
          deleteButton.className = 'mini';
          deleteButton.onclick = () => deleteShift(shift.id);
          li.appendChild(deleteButton);
          pastShifts.appendChild(li);
        });
      }

      async function create(e) {
        e.preventDefault();

        const dateInput = document.getElementById('date');
        const date = dateInput.value;

        // 時間を保存
        saveCurrentTime(date);

        try {
          await addShift(date);
          
          // 日付部分のみリセット（時間は保持）
          const timeOnly = date.split('T')[1]; // 時間部分を取得
          const today = new Date().toISOString().split('T')[0]; // 今日の日付
          dateInput.value = today + 'T' + timeOnly; // 今日の日付 + 入力された時間
          
        } catch (error) {
          console.error('シフトの追加に失敗しました:', error);
          alert(`シフトの追加に失敗しました: ${error.message}`);
        }
      }

      async function addShift(date) {
        try {
          const response = await fetch('/api/shifts', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ date })
          });
          
          if (!response.ok) {
            const errorData = await response.json();
            if (response.status === 400 && errorData.error) {
              // 重複エラーなど、ユーザーに表示すべきエラー
              throw new Error(errorData.error);
            } else {
              // その他のサーバーエラー
              throw new Error('サーバーエラーが発生しました');
            }
          }
          
          fetchShifts();
        } catch (error) {
          console.error('API呼び出しエラー:', error);
          throw error; // 上位の関数でもエラーハンドリングできるように再スロー
        }
      }

      async function deleteShift(id) {
        try {
          const response = await fetch(`/api/shifts/${id}`, {
            method: 'DELETE'
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          fetchShifts();
        } catch (error) {
          console.error('シフトの削除に失敗しました:', error);
          alert('シフトの削除に失敗しました。もう一度お試しください。');
        }
      }

      async function logout() {
        try {
          const response = await fetch('/api/users/logout', {
            method: 'POST'
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          window.location.href = '/';
        } catch (error) {
          console.error('ログアウトに失敗しました:', error);
          alert('ログアウトに失敗しました。ページを再読み込みしてください。');
        }
      }
    </script>